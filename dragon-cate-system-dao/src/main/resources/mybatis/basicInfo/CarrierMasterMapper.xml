<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="titan.wms.common.dao.mapper.basicInfo.CarrierMasterMapper">

    <sql id="TABLE_NAME">
        basic_carrier_master
    </sql>

    <sql id="INSERT_ALL_COLUMNS">
        `code`, `name`, `type`, `zip_code`, `contacts`, `cellphone`, `telephone`,
        `fax`, `email`, `address`, `is_available`,
        `operator_id`, `create_time`, `update_time`
    </sql>
    <sql id="SELECT_ALL_COLUMNS">
        `id`,
        <include refid="INSERT_ALL_COLUMNS"/>
    </sql>

    <resultMap id="carrierMaterMap" type="CarrierMasterDO">
        <result column="id" property="id"/>
        <result column="code" property="code"/>
        <result column="name" property="name"/>
        <result column="short_name" property="shortName"/>
        <result column="type" property="type"/>
        <result column="zip_code" property="zipCode"/>
        <result column="contacts" property="contacts"/>
        <result column="cellphone" property="cellphone"/>
        <result column="telephone" property="telephone"/>
        <result column="fax" property="fax"/>
        <result column="email" property="email"/>
        <result column="address" property="address"/>
        <result column="is_available" property="available"/>
        <result column="operator_id" property="operatorId"/>
        <result column="is_valid" property="valid"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <insert id="addCarrierMaster" parameterType="CarrierMasterDO" useGeneratedKeys="true"
            keyProperty="id">
        INSERT into
        <include refid="TABLE_NAME"/>
        (
        <include refid="INSERT_ALL_COLUMNS"/>
        )
        VALUES ( #{code}, #{name},#{short_name}, #{type}, #{zipCode},#{contacts}, #{cellphone},
        #{telephone}, #{fax}, #{email}, #{address}, #{available},
        #{operatorId}, now(), now())
    </insert>

    <update id="updateCarrierMaster" parameterType="CarrierMasterDO">
        UPDATE
        <include refid="TABLE_NAME"/>
        <set>
            <if test="name != null and name !='' ">
                name = #{name},
            </if>
            <if test="shortName != null and shortName !='' ">
                short_name = #{shortName},
            </if>
            <if test="zipCode != null and zipCode != ''">
                zip_code = #{zipCode},
            </if>
            <if test="contacts != null and contacts !='' ">
                contacts = #{contacts},
            </if>
            <if test="cellphone != null and cellphone !='' ">
                cellphone = #{cellphone},
            </if>
            <if test="telephone != null and telephone !='' ">
                telephone = #{telephone},
            </if>
            <if test="fax != null and fax != '' ">
                fax = #{fax},
            </if>
            <if test="email != null and email != '' ">
                email = #{email},
            </if>
            <if test="address != null and address != '' ">
                address = #{address},
            </if>
            <if test="available != null">
                is_available = #{available},
            </if>
            <if test="operatorId != null and operatorId != ''">
                operator_id = #{operatorId},
            </if>
            <if test="type != null">
                type = #{type},
            </if>
            update_time = now()
        </set>
        WHERE id = #{id}
    </update>

    <select id="queryCarrierMaster" parameterType="CarrierMasterDO" resultMap="carrierMaterMap">
        SELECT
        <include refid="SELECT_ALL_COLUMNS"/>
        FROM
        <include refid="TABLE_NAME"/>
        WHERE is_available= true and is_valid = true and id=#{id};
    </select>

    <select id="queryCarrierMasterById" resultMap="carrierMaterMap">
        SELECT
        <include refid="SELECT_ALL_COLUMNS"/>
        FROM
        <include refid="TABLE_NAME"/>
        WHERE is_available= true and is_valid = true and id=#{id};
    </select>


    <select id="countAll" resultType="java.lang.Integer">
        SELECT count(*) FROM
        <include refid="TABLE_NAME"/>
        <where>
            is_valid = true
            <if test="queryVO.code != null and  queryVO.code != '' ">
                and code like CONCAT('%', #{queryVO.code} ,'%')
            </if>
            <if test="queryVO.name != null and queryVO.name != '' ">
                and name like CONCAT('%', #{queryVO.name} ,'%')
            </if>
            <if test="queryVO.shortName != null and queryVO.shortName != '' ">
                and shortName like CONCAT('%', #{queryVO.shortName} ,'%')
            </if>
            <if test="queryVO.type != null">
                and type=#{queryVO.type}
            </if>
            <if test="queryVO.available != null">
                and is_available = #{queryVO.available}
            </if>
        </where>
    </select>

    <select id="listCarrierMasters" resultMap="carrierMaterMap">
        select * from
        <include refid="TABLE_NAME"/>
        <where>
            is_valid = true
            <if test="queryVO.code != null and queryVO.code != ''">
                and code like CONCAT('%', #{queryVO.code} ,'%')
            </if>
            <if test="queryVO.name != null and queryVO.name != ''">
                and name like CONCAT('%', #{queryVO.name} ,'%')
            </if>
            <if test="queryVO.shortName != null and queryVO.shortName != '' ">
                and shortName like CONCAT('%', #{queryVO.shortName} ,'%')
            </if>
            <if test="queryVO.type != null">
                and type = #{queryVO.type}
            </if>
            <if test="queryVO.available != null">
                and is_available = #{queryVO.available}
            </if>
        </where>
        order by id desc limit #{limit} offset #{offset}
    </select>

    <select id="vagueListCarrierInfo" resultMap="carrierMaterMap">
        SELECT * FROM
        <include refid="TABLE_NAME"/>
        WHERE is_valid = true
        <if test="param != null and param != ''">
            and (code like CONCAT('%', #{param} ,'%') or name like CONCAT('%', #{param} ,'%'))
        </if>
    </select>

    <!-- 根据 code 查找承运商 -->
    <select id="getByCode" resultMap="carrierMaterMap">
        SELECT id, code, `name` FROM <include refid="TABLE_NAME"/> WHERE code = #{code}
    </select>
</mapper>