<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="titan.wms.common.dao.mapper.basicInfo.ContainerTemplateMapper">

    <sql id="TABLE_NAME">
        basic_container_template
    </sql>

    <sql id="INSERT_ALL_COLUMNS">
        `specification`, `category`, `length`, `width`,
        `height`, `volume`, `weight`, `weight_limit`,
        `put_wall_layers`,`put_wall_grids`,`put_wall_length`,`put_wall_width`,`put_wall_height`,
        `operator_id`, `create_time`, `update_time`
    </sql>

    <sql id="SELECT_ALL_COLUMNS">
        `id`,
        <include refid="INSERT_ALL_COLUMNS"/>
    </sql>

    <resultMap id="containerTemplateMap" type="ContainerTemplateDO">
        <result column="id" property="id"/>
        <result column="specification" property="specification"/>
        <result column="category" property="category"/>
        <result column="length" property="length"/>
        <result column="width" property="width"/>
        <result column="height" property="height"/>
        <result column="volume" property="volume"/>
        <result column="weight" property="weight"/>
        <result column="weight_limit" property="weightLimit"/>
        <result column="put_wall_layers" property="putWallLayers"/>
        <result column="put_wall_grids" property="putWallGrids"/>
        <result column="put_wall_length" property="putWallLength"/>
        <result column="put_wall_width" property="putWallWidth"/>
        <result column="put_wall_height" property="putWallHeight"/>
        <result column="operator_id" property="operatorId"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <insert id="add" parameterType="ContainerTemplateDO" useGeneratedKeys="true" keyProperty="id">
        INSERT into
        <include refid="TABLE_NAME"/>
        (
        <include refid="INSERT_ALL_COLUMNS"/>
        )
        VALUES ( #{specification}, #{category}, #{length}, #{width}, #{height}, #{volume}, #{weight}, #{weightLimit},
         #{putWallLayers}, #{putWallGrids}, #{putWallLength}, #{putWallWidth}, #{putWallHeight},
        #{operatorId}, now(), now())
    </insert>

    <update id="update" parameterType="ContainerTemplateDO">
        UPDATE
        <include refid="TABLE_NAME"/>
        <set>
            <if test="category != null">
                category = #{category},
            </if>
            <if test="length != null">
                length = #{length},
            </if>
            <if test="width != null">
                width = #{width},
            </if>
            <if test="height != null">
                height = #{height},
            </if>
            <if test="volume != null">
                volume = #{volume},
            </if>
            <if test="weight != null">
                weight = #{weight},
            </if>
            <if test="weightLimit != null">
                weight_limit = #{weightLimit},
            </if>
            <if test="putWallLayers != null">
                put_wall_layers = #{putWallLayers},
            </if>
            <if test="putWallGrids != null">
                put_wall_grids = #{putWallGrids},
            </if>
            <if test="putWallLength != null">
                put_wall_length = #{putWallLength},
            </if>
            <if test="putWallWidth != null">
                put_wall_width = #{putWallWidth},
            </if>
            <if test="putWallHeight != null">
                put_wall_height = #{putWallHeight},
            </if>
            <if test="operatorId != null and operatorId != '' ">
                operator_id = #{operatorId},
            </if>
            update_time = now()
        </set>
        WHERE id = #{id}
    </update>

    <select id="getById" resultMap="containerTemplateMap">
        SELECT
        <include refid="SELECT_ALL_COLUMNS"/>
        FROM
        <include refid="TABLE_NAME"/>
        WHERE id=#{id} and is_valid = true
        <if test="needLock == true"> for update</if>
    </select>

    <select id="pageCount" resultType="java.lang.Integer">
        SELECT count(*) FROM
        <include refid="TABLE_NAME"/>
        <where>
            is_valid=true
            <if test="conditionVO.specification != null and conditionVO.specification != ''">
                and specification like CONCAT('%', #{conditionVO.specification} ,'%')
            </if>

            <if test="conditionVO.category != null">
                and category = #{conditionVO.category}
            </if>
        </where>
    </select>

    <select id="list" resultMap="containerTemplateMap">
        select * from
        <include refid="TABLE_NAME"/>
        <where>
            is_valid = true
            <if test="conditionVO.specification != null and conditionVO.specification != ''">
                and specification like CONCAT('%', #{conditionVO.specification} ,'%')
            </if>
            <if test="conditionVO.category != null">
                and category = #{conditionVO.category}
            </if>
        </where>
        order by id desc <if test="limit != -1">limit #{limit} offset #{offset}</if> <if test="limit == -1">limit 20 offset 0</if>
    </select>

    <update id="delete">
        UPDATE
        <include refid="TABLE_NAME"/>
        SET is_valid = false
        where id = #{id}
    </update>

</mapper>