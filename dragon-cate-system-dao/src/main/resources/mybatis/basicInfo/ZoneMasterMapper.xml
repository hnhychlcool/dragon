<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="titan.wms.common.dao.mapper.basicInfo.ZoneMasterMapper">

    <sql id="TABLE_NAME">
        basic_zone_master
    </sql>

    <sql id="INSERT_ALL_COLUMNS">
        `area_id`, `code`, `name`, `type`, `is_fcl_picking`, `is_piece_picking`, `is_pallet_picking`,
        `operator_id`, `create_time`, `update_time`
    </sql>
    <sql id="SELECT_ALL_COLUMNS">
        `id`,
        <include refid="INSERT_ALL_COLUMNS"/>
    </sql>

    <resultMap id="zoneMap" type="ZoneMasterDO">
        <result column="id" property="id"/>
        <result column="area_id" property="areaId"/>
        <result column="code" property="code"/>
        <result column="name" property="name"/>
        <result column="type" property="type"/>
        <result column="is_fcl_picking" property="fclPicking"/>
        <result column="is_piece_picking" property="piecePicking"/>
        <result column="is_pallet_picking" property="palletPicking"/>
        <result column="operator_id" property="operatorId"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_valid" property="valid"/>
    </resultMap>

    <insert id="addZoneMaster" parameterType="ZoneMasterDO" useGeneratedKeys="true" keyProperty="id">
        INSERT into
        <include refid="TABLE_NAME"/>
        (
        <include refid="INSERT_ALL_COLUMNS"/>
        )
        VALUES (#{areaId}, #{code}, #{name}, #{type}, #{fclPicking}, #{piecePicking},
        #{palletPicking}, #{operatorId}, now(), now())
    </insert>

    <update id="updateZoneMaster" parameterType="ZoneMasterDO">
        UPDATE
        <include refid="TABLE_NAME"/>
        <set>
            <if test="areaId != null and areaId > 0 ">
                area_id = #{areaId},
            </if>
            <if test="code != null and code != ''">
                code = #{code},
            </if>
            <if test="name != null and name !='' ">
                name = #{name},
            </if>
            <if test="type != null">
                type = #{type},
            </if>
            <if test="fclPicking != null">
                is_fcl_picking = #{fclPicking},
            </if>
            <if test="piecePicking != null">
                is_piece_picking = #{piecePicking},
            </if>
            <if test="palletPicking != null">
                is_pallet_picking = #{palletPicking},
            </if>
            <if test="operatorId != null and operatorId != '' ">
                operator_id = #{operatorId},
            </if>
            update_time = now()
        </set>
        WHERE id = #{id}
    </update>

    <update id="deleteZone">
        UPDATE
        <include refid="TABLE_NAME"/>
        SET is_valid = false
        where  id = #{id}
    </update>


    <select id="listZoneMasters" resultMap="zoneMap">
        SELECT
        <include refid="SELECT_ALL_COLUMNS"/>
        FROM
        <include refid="TABLE_NAME"/>
        <where>
            is_valid = true
            <if test="code != null and code != '' ">
                and code like CONCAT('%', #{code} ,'%')
            </if>
            <if test="name != null and name != '' ">
                and name like CONCAT('%', #{name} ,'%')
            </if>
            <if test="areaId != null">
                and area_id = #{areaId}
            </if>
            <if test="type != null">
                and type = #{type}
            </if>
        </where>
        order by id desc limit #{limit} offset #{offset}
    </select>

    <select id="vagueListZoneMasters" resultMap="zoneMap">
        select * from
        <include refid="TABLE_NAME"/>
        <where>
            is_valid = true
            <if test="type != null and type != 0">
                and type = #{type}
            </if>
            and
            (code like CONCAT('%', #{param} ,'%') or name like CONCAT('%', #{param} ,'%'))
        </where>
        limit 10;
    </select>

    <select id="countAll" resultType="java.lang.Integer">
        SELECT count(*) FROM
        <include refid="TABLE_NAME"/>
        <where>
           is_valid = true
            <if test="code != null and code != '' ">
                and code like CONCAT('%', #{code} ,'%')
            </if>
            <if test="name != null and name != '' ">
                and name like CONCAT('%', #{name} ,'%')
            </if>
            <if test="areaId != null">
                and area_id = #{areaId}
            </if>
            <if test="type != null">
                and type = #{type}
            </if>
        </where>
    </select>

    <select id="getZoneMasterById" resultMap="zoneMap">
        SELECT
        <include refid="SELECT_ALL_COLUMNS"/>
        FROM
        <include refid="TABLE_NAME"/>
        <where>
            is_valid = true
            and id=#{id}
        </where>
    </select>

    <select id="getZoneMasterByCode" resultMap="zoneMap">
        SELECT
        <include refid="SELECT_ALL_COLUMNS"/>
        FROM
        <include refid="TABLE_NAME"/>
        <where>
            is_valid = true
            and code=#{code}
        </where>
    </select>

</mapper>