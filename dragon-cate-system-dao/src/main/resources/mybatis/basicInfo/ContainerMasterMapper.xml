<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="titan.wms.common.dao.mapper.basicInfo.ContainerMasterMapper">

    <sql id="TABLE_NAME">
        basic_container_master
    </sql>

    <sql id="INSERT_ALL_COLUMNS">
        `template_id`,`template_name`, `code`, `use_type`,`cur_use_type`, `status`, `is_used`,`is_general`,
        `operator_id`, `create_time`, `update_time`
    </sql>
    <sql id="SELECT_ALL_COLUMNS">
        `id`,
        <include refid="INSERT_ALL_COLUMNS"/>
    </sql>

    <resultMap id="containerMasterMap" type="ContainerMasterDO">
        <result column="id" property="id"/>
        <result column="template_id" property="templateId"/>
        <result column="template_name" property="templateName"/>
        <result column="code" property="code"/>
        <result column="use_type" property="useType"/>
        <result column="cur_use_type" property="curUseType"/>
        <result column="status" property="status"/>
        <result column="is_used" property="used"/>
        <result column="operator_id" property="operatorId"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_valid" property="valid"/>
    </resultMap>

    <insert id="addContainerMaster" parameterType="ContainerMasterDO" useGeneratedKeys="true" keyProperty="id">
        INSERT into
        <include refid="TABLE_NAME"/>
        (
        <include refid="INSERT_ALL_COLUMNS"/>
        )
        VALUES ( #{templateId},#{templateName}, #{code}, #{useType},#{curUseType}, #{status}, #{used}
        #{operatorId}, now(), now())
    </insert>

    <insert id="batAddContainerMaster" parameterType="java.util.List">
        INSERT INTO
        <include refid="TABLE_NAME"/>
        (
        <include refid="INSERT_ALL_COLUMNS"/>
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            ( #{item.templateId},#{item.templateName}, #{item.code},
            #{item.useType},#{item.curUseType}, #{item.status}, #{item.used},
            #{item.operatorId}, now(), now()
            )
        </foreach>
    </insert>

    <update id="updateContainerStatusByCode">
        UPDATE
        <include refid="TABLE_NAME"/>
        SET
        status = #{status},
        update_time = now()
        WHERE
        code = #{code}
    </update>

    <update id="updateContainerStatusAndUseWayByCode">
        UPDATE
        <include refid="TABLE_NAME"/>
        SET
        status = #{status},
        use_type = #{useType},
        update_time = now()
        WHERE
        code = #{code}
    </update>

    <update id="updateContainerMaster" parameterType="ContainerMasterDO">
        UPDATE
        <include refid="TABLE_NAME"/>
        <set>
            <if test="templateId != null">
                template_id = #{templateId},
            </if>
            <if test="useType != null">
                use_type = #{useType},
            </if>
            <if test="curUseType != null">
                cur_use_type = #{curUseType},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
            <if test="used != null">
                is_used = #{used},
            </if>
            <if test="operatorId != null and operatorId != '' ">
                operator_id = #{operatorId},
            </if>
            update_time = now()
        </set>
        <where>
            <if test="id != null and id != 0">
                and id=#{id}
            </if>
            <if test="code != null and code != '' ">
                and code = #{code}
            </if>
        </where>
    </update>

    <select id="queryContainerMaster" parameterType="ContainerMasterDO" resultMap="containerMasterMap">
        SELECT
        <include refid="SELECT_ALL_COLUMNS"/>
        FROM
        <include refid="TABLE_NAME"/>
        <where>
            is_valid=true
            <if test="id != null and id != 0">
                and id=#{id}
            </if>
            <if test="code != null and code != '' ">
                and code = #{code}
            </if>
        </where>

    </select>

    <select id="countAll" resultType="java.lang.Integer">
        SELECT count(*) FROM
        <include refid="TABLE_NAME"/>
        <where>
            is_valid=true
            <if test="queryVO.code != null and queryVO.code != '' ">
                and code like CONCAT('%', #{queryVO.code} ,'%')
            </if>
            <if test="queryVO.templateId != null and queryVO.templateId != 0">
                and template_id = #{queryVO.templateId}
            </if>
            <if test="queryVO.used != null">
                and is_used = #{queryVO.used}
            </if>
            <if test="queryVO.useType != null">
                and use_type = #{queryVO.useType},
            </if>
            <if test="queryVO.curUseType != null">
                and cur_use_type = #{queryVO.curUseType},
            </if>
            <if test="queryVO.status != null">
                and status = #{queryVO.status}
            </if>
        </where>
    </select>

    <select id="listContainerMaster" resultMap="containerMasterMap">
        select * from
        <include refid="TABLE_NAME"/>
        <where>
            is_valid=true
            <if test="queryVO.code != null and queryVO.code != ''">
                and code like CONCAT('%', #{code} ,'%')
            </if>
            <if test="queryVO.templateId != null and queryVO.templateId != 0">
                and template_id = #{queryVO.templateId}
            </if>
            <if test="queryVO.useType != null">
                and use_type = #{queryVO.useType},
            </if>
            <if test="queryVO.curUseType != null">
                and cur_use_type = #{queryVO.curUseType},
            </if>
            <if test="queryVO.status != null">
                and status = #{queryVO.status}
            </if>
            <if test="queryVO.used != null">
                and is_used = #{queryVO.used}
            </if>
        </where>
        order by id desc <if test="limit != -1">limit #{limit} offset #{offset}</if>
    </select>

    <update id="deleteContainer">
        UPDATE
        <include refid="TABLE_NAME"/>
        SET is_valid = 0
        where id = #{id}
    </update>

    <select id="getById" resultMap="containerMasterMap">
        select * from
        <include refid="TABLE_NAME"/>
        where id=#{id} and is_valid=true <if test="needLock == true" > for update</if>
    </select>

    <select id="getByCode" resultMap="containerMasterMap">
        select * from
        <include refid="TABLE_NAME"/>
        where code = #{queryVO.code} and is_valid = true
    </select>

    <select id="vagueListContainerMaster" resultMap="containerMasterMap">
        select *
        from
        <include refid="TABLE_NAME"/>
        <where>
            is_valid=true
            and (code like CONCAT('%', #{queryVO.code} ,'%'))
        </where>
        limit 10
    </select>
</mapper>