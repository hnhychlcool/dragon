<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="titan.wms.common.dao.mapper.basicInfo.GoodsLocationMasterMapper">

    <sql id="TABLE_NAME">
        basic_goods_location_master
    </sql>

    <sql id="INSERT_ALL_COLUMNS">
        `code`,
        `goods_location_group_code`,
        `goods_shelves_type`,
        `goods_shelves_id`,
        `goods_shelves_name`,
        `floor`,
        `area`,
        `channel`,
        `layer`,
        `position`,
        `putaway_zone`,
        `working_zone`,
        `gathering_zone`,
        `category`,
        `goods_type_limit`,
        `max_lpn_count`,
        `trace_lpn`,
        `working_seq`,
        `bearing`,
        `length`,
        `width`,
        `height`,
        `available`,
        `is_full`,
        `related_order`,
        `operator_id`,
        `create_time`,
        `update_time`
    </sql>

    <sql id="SELECT_ALL_COLUMNS">
        `id`,
        <include refid="INSERT_ALL_COLUMNS"/>
    </sql>

    <resultMap id="goodsLocationMasterMap" type="GoodsLocationMasterDO">
        <result column="id" property="id"/>
        <result column="code" property="code"/>
        <result column="goods_location_group_code" property="goodsLocationGroupCode"/>
        <result column="goods_shelves_type" property="goodsShelvesType"/>
        <result column="goods_shelves_id" property="goodsShelvesId"/>
        <result column="goods_shelves_name" property="goodsShelvesName"/>
        <result column="floor" property="floor"/>
        <result column="area" property="area"/>
        <result column="channel" property="channel"/>
        <result column="layer" property="layer"/>
        <result column="position" property="position"/>
        <result column="putaway_zone" property="putawayZone"/>
        <result column="working_zone" property="workingZone"/>
        <result column="gathering_zone" property="gatheringZone"/>
        <result column="category" property="category"/>
        <result column="goods_type_limit" property="goodsTypeLimit"/>
        <result column="max_lpn_count" property="maxLpnCount"/>
        <result column="trace_lpn" property="traceLpn"/>
        <result column="working_seq" property="workingSeq"/>
        <result column="bearing" property="bearing"/>
        <result column="length" property="length"/>
        <result column="width" property="width"/>
        <result column="height" property="height"/>
        <result column="available" property="available"/>
        <result column="is_full" property="isFull"/>
        <result column="related_order" property="relatedOrder"/>
        <result column="operator_id" property="operatorId"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <insert id="insert" parameterType="titan.wms.common.dao.meta.basicInfo.GoodsLocationMasterDO" useGeneratedKeys="true" keyProperty="id">
        INSERT into
        <include refid="TABLE_NAME"/>
        (
        <include refid="INSERT_ALL_COLUMNS"/>
        )
        VALUES (
        #{code},
        #{goodsLocationGroupCode},
        #{goodsShelvesType},
        #{goodsShelvesId},
        #{goodsShelvesName},
        #{floor},
        #{area},
        #{channel},
        #{layer},
        #{position},
        #{putawayZone},
        #{workingZone},
        #{gatheringZone},
        #{category},
        #{goodsTypeLimit},
        #{maxLpnCount},
        #{traceLpn},
        #{workingSeq},
        #{bearing},
        #{length},
        #{width},
        #{height},
        #{available},
        #{isFull},
        #{relatedOrder},
        #{operatorId},
        now(),
        now())
    </insert>

    <insert id="batchInsert" parameterType="java.util.List">
        INSERT INTO
        <include refid="TABLE_NAME"/>
        (
        <include refid="INSERT_ALL_COLUMNS"/>
        )
        VALUES
        <foreach collection="list" item="pojo" index="index" separator=",">
            (
            #{pojo.code},
            #{pojo.goodsLocationGroupCode},
            #{pojo.goodsShelvesType},
            #{pojo.goodsShelvesId},
            #{pojo.goodsShelvesName},
            #{pojo.floor},
            #{pojo.area},
            #{pojo.channel},
            #{pojo.layer},
            #{pojo.position},
            #{pojo.putawayZone},
            #{pojo.workingZone},
            #{pojo.gatheringZone},
            #{pojo.category},
            #{pojo.goodsTypeLimit},
            #{pojo.maxLpnCount},
            #{pojo.traceLpn},
            #{pojo.workingSeq},
            #{pojo.bearing},
            #{pojo.length},
            #{pojo.width},
            #{pojo.height},
            #{pojo.available},
            #{pojo.isFull},
            #{pojo.relatedOrder},
            #{pojo.operatorId},
            now(),
            now())
        </foreach>
    </insert>

    <sql id="updateField">
        <if test="pojo.putawayZone != null"> `putaway_zone` = #{pojo.putawayZone}, </if>
        <if test="pojo.workingZone != null"> `working_zone` = #{pojo.workingZone}, </if>
        <if test="pojo.gatheringZone != null"> `gathering_zone` = #{pojo.gatheringZone}, </if>
        <if test="pojo.category != null"> `category` = #{pojo.category}, </if>
        <if test="pojo.goodsTypeLimit != null"> `goods_type_limit` = #{pojo.goodsTypeLimit}, </if>
        <if test="pojo.maxLpnCount != null"> `max_lpn_count` = #{pojo.maxLpnCount}, </if>
        <if test="pojo.traceLpn != null"> `trace_lpn` = #{pojo.traceLpn}, </if>
        <if test="pojo.workingSeq != null"> `working_seq` = #{pojo.workingSeq}, </if>
        <if test="pojo.bearing != null"> `bearing` = #{pojo.bearing}, </if>
        <if test="pojo.length != null"> `length` = #{pojo.length}, </if>
        <if test="pojo.width != null"> `width` = #{pojo.width}, </if>
        <if test="pojo.height != null"> `height` = #{pojo.height}, </if>
        <if test="pojo.available != null"> `available` = #{pojo.available}, </if>
        <if test="pojo.isFull != null"> `is_full` = #{pojo.isFull}, </if>
        <if test="pojo.relatedOrder != null"> `related_order` = #{pojo.relatedOrder}, </if>
        <if test="pojo.operatorId != null"> `operator_id` = #{pojo.operatorId}, </if>
        update_time = now()
    </sql>

    <update id="update" parameterType="titan.wms.common.dao.meta.basicInfo.GoodsLocationMasterDO">
        UPDATE <include refid="TABLE_NAME"/>
        <set>
            <include refid="updateField"/>
        </set>
        WHERE id = #{pojo.id}
    </update>

    <update id="batchUpdate" parameterType="titan.wms.common.dao.meta.basicInfo.vo.GoodsLocationBatchUpdateVO">
        UPDATE
        <include refid="TABLE_NAME"/>
        <set>
            <include refid="updateField"/>
        </set>
        WHERE
        `floor` between #{pojo.startPosition.floor} and #{pojo.endPosition.floor}
        and `area` between #{pojo.startPosition.area} and #{pojo.endPosition.area}
        and `channel` between #{pojo.startPosition.channel} and #{pojo.endPosition.channel}
        <!--and `layer` between #{pojo.startPosition.layer} and #{pojo.endPosition.layer}-->
    </update>

    <select id="findExistsCodes" resultType="java.lang.String">
        SELECT  `code`
        FROM
        <include refid="TABLE_NAME"/>
        <where>
            <if test="codes != null and codes.size() > 0">
                `code` in
                <foreach collection="codes" open="(" close=")" item="code" separator=",">
                    #{code}
                </foreach>
            </if>
        </where>
    </select>

    <select id="getById" resultMap="goodsLocationMasterMap">
        SELECT
        <include refid="SELECT_ALL_COLUMNS"/>
        FROM
        <include refid="TABLE_NAME"/>
        WHERE id=#{id}
    </select>

    <sql id="queryCondition">
        <if test="query.available != null">
            and available = #{query.available}
        </if>
        <if test="query.startLocationCode != null">
            and code >= #{query.startLocationCode}
        </if>
        <if test="query.endLocationCode != null">
            and code &lt;= #{query.endLocationCode}
        </if>
        <if test="query.category != null">
            and category = #{query.category}
        </if>
        <if test="query.putawayZone != null">
            and putaway_zone = #{query.putawayZone}
        </if>
        <if test="query.workingZone != null">
            and working_zone = #{query.workingZone}
        </if>
        <if test="query.gatheringZone != null">
            and gathering_zone = #{query.gatheringZone}
        </if>
        <if test="query.goodsShelvesType != null">
            and goods_shelves_type = #{query.goodsShelvesType}
        </if>
        <if test="query.goodsShelvesId != null">
            and goods_shelves_id = #{query.goodsShelvesId}
        </if>
        <if test="query.floor != null">
            and floor = #{query.floor}
        </if>
        <if test="query.area != null">
            and area = #{query.area}
        </if>
        <if test="query.channel != null">
            and channel = #{query.channel}
        </if>
        <if test="query.layer != null">
            and layer = #{query.layer}
        </if>
        <if test="query.goodsLocationGroupCode != null">
            and goods_location_group_code = #{query.goodsLocationGroupCode}
        </if>
    </sql>

    <select id="countAll" resultType="java.lang.Integer">
        SELECT count(*) FROM
        <include refid="TABLE_NAME"/>
        <where>
            <include refid="queryCondition"/>
        </where>
    </select>

    <select id="list" resultMap="goodsLocationMasterMap">
        SELECT
        <include refid="SELECT_ALL_COLUMNS"/>
        FROM
        <include refid="TABLE_NAME"/>
        <where>
            <include refid="queryCondition"/>
        </where>
        order by id desc limit #{limit} offset #{offset}
    </select>

    <select id="listLocationByCode" resultMap="goodsLocationMasterMap">
        SELECT *
        FROM
        <include refid="TABLE_NAME"/> WHERE code in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{code}
        </foreach>
    </select>

    <select id="listLocationByChannel" resultType="java.lang.String">
        SELECT code
        FROM
        <include refid="TABLE_NAME"/> WHERE channel = #{channel}
    </select>

    <update id="delete">
        DELETE FROM
        <include refid="TABLE_NAME"/>
        where id = #{id}
    </update>

    <select id="getByCode" resultMap="goodsLocationMasterMap">
        select
        <include refid="SELECT_ALL_COLUMNS"/>
        from <include refid="TABLE_NAME"/>
        where code = #{code}
    </select>
    <update id="addLocation2Group" >
        UPDATE <include refid="SELECT_ALL_COLUMNS"/> SET goods_location_group_code = #{locationGroupCode} where id in
        <foreach collection="locationIds" item="id" index="index" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

    <update id="removeLocationFromGroup" >
        UPDATE <include refid="SELECT_ALL_COLUMNS"/> SET goods_location_group_code = NULL where goods_location_group_code = #{locationGroupCode}
        <where>
            <if test="locationIds != null">
                and id in
                <foreach collection="locationIds" item="id" index="index" open="(" separator="," close=")">
                    #{id}
                </foreach>
            </if>
        </where>

    </update>
</mapper>