<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="titan.wms.common.dao.mapper.inbound.InboundTallyTitleMapper">
    <resultMap id="tallyTitleResultMap" type="InboundTallyTitleDO">
        <result column="id" property="id"/>
        <result column="tally_no" property="tallyNo"/>
        <result column="purchase_no" property="purchaseNo"/>
        <result column="inbound_no" property="inboundNo"/>
        <result column="approval_no" property="approvalNo"/>
        <result column="inspection_no" property="inspectionNo"/>
        <result column="tally_status" property="tallyStatus"/>
        <result column="plan_tally_count" property="planTallyCount"/>
        <result column="actual_tally_count" property="actualTallyCount"/>
        <result column="more_count" property="moreCount"/>
        <result column="less_count" property="lessCount"/>
        <result column="bad_count" property="badCount"/>
        <result column="diff_rate" property="diffRate"/>
        <result column="start_tally_time" property="startTallyTime"/>
        <result column="finish_tally_time" property="finishTallyTime"/>
        <result column="submit_tally_time" property="submitTallyTime"/>
        <result column="verify_tally_time" property="verifyTallyTime"/>
        <result column="data_source" property="dataSource"/>
        <result column="overall_situation" property="overallSituation"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <sql id="TableName">
        inbound_tally_title
    </sql>

    <sql id="BaseColumn">
        `tally_no`,
        `purchase_no`,
        `inbound_no`,
        `approval_no`,
        `inspection_no`,
        `tally_status`,
        `plan_tally_count`,
        `actual_tally_count`,
        `more_count`,
        `less_count`,
        `bad_count`,
        `diff_rate`,
        `start_tally_time`,
        `finish_tally_time`,
        `submit_tally_time`,
        `verify_tally_time`,
        `data_source`,
        `overall_situation`,
        `create_time`,
        `update_time`
    </sql>

    <insert id="insert" parameterType="InboundTallyTitleDO" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO
        <include refid="TableName"/>
        (<include refid="BaseColumn"/>)
        VALUES(
        #{tallyNo},
        #{purchaseNo},
        #{inboundNo},
        #{approvalNo},
        #{inspectionNo},
        #{tallyStatus},
        #{planTallyCount},
        #{actualTallyCount},
        #{moreCount},
        #{lessCount},
        #{badCount},
        #{diffRate},
        #{startTallyTime},
        #{finishTallyTime},
        #{submitTallyTime},
        #{verifyTallyTime},
        #{dataSource},
        #{overallSituation},
        NOW(),
        NOW()
        )
    </insert>

    <select id="getByTallyNo" resultMap="tallyTitleResultMap">
        SELECT
        id,
        <include refid="BaseColumn"/>
        FROM
        <include refid="TableName"/>
        WHERE
        tally_no = #{tallyNo}
    </select>

    <select id="getTallyTitleList" resultMap="tallyTitleResultMap">
        SELECT * FROM
        <include refid="TableName"/>
        <where>
            1=1
            <if test="purchaseNo != null and purchaseNo != ''">
                AND purchase_no = #{purchaseNo}
            </if>
            <if test="approvalNo != null and approvalNo != ''">
                AND approval_no = #{approvalNo}
            </if>
            <if test="inboundNo != null and inboundNo != ''">
                AND inbound_no = #{inboundNo}
            </if>
            <if test="tallyStatus != null">
                AND tallyStatus = #{tallyStatus}
            </if>
            <if test="inspectionNo != null and inspectionNo != ''">
                AND inspection_no = #{inspectionNo}
            </if>
            <if test="createTime != null and createTime != ''">
                AND create_time = #{createTime}
            </if>
        </where>
        <if test="limit != -1">limit #{limit} offset #{offset}</if>
    </select>

    <delete id="deleteByTallyNo">
        DELETE
        FROM
        <include refid="TableName"/>
        WHERE
        tally_no = #{tallyNo}
    </delete>

</mapper>